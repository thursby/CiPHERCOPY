```
      ______ ___  __ _________  ________  _____  __
     ╱ ___(_) _ ╲╱ ╱╱ ╱ __╱ _ ╲╱ ___╱ _ ╲╱ _ ╲ ╲╱ ╱
    ╱ ╱__╱ ╱ ___╱ _  ╱ _╱╱ , _╱ ╱__╱ (/ ╱ ___╱╲  ╱
    ╲___╱_╱_╱  ╱_╱╱_╱___╱_╱│_│╲___╱╲___╱_╱    ╱_╱
```
# CiPHERCOPY

High-performance file copy & verification toolkit providing:

* A multi-threaded command-line interface (CLI) with live ANSI progress bars.
* A cross‑platform Flutter graphical user interface (GUI) with a step‑by‑step process, rich progress, cancellation, and log interactions.
* A reusable core library (`ciphercopy_core`) exposing copy & verify primitives, progress events, and cooperative cancellation.

## Motivation

Traditionally, file copying and hashing were single-threaded because older hard drives couldn’t handle multiple operations efficiently. Their slow seek times made parallel work counterproductive. With today’s SSDs and fast RAID arrays, storage is much faster, and single-threaded tools can actually become the bottleneck, especially when moving many files or large amounts of data.

CiPHERCOPY was built to take advantage of today’s multi-core CPUs and fast storage, letting you copy and verify files in parallel for much better performance. Copying from a list of files (instead of just directories) is also a feature I found missing in most tools, so I made it a core part of this project.

On top of that, I wanted to dig deeper into Dart and Flutter’s multi-threading model so this was a great way to learn about isolates and build something genuinely useful at the same time.

---

## GUI (Flutter Application)

The GUI lives in `app/` and offers an accessible step-by-step workflow for both Copy and Verify operations without remembering flags.

### GUI Features
* Three-steps: Operation -> Configure -> Progress
* Copy mode: select a plain text list of source file paths and a destination directory.
* Verify mode: select an existing `hashes.sha1` manifest generated by a previous copy.
* Optional toggle to also write `copied.txt` & `errored.txt` to the destination directory (equivalent to CLI `-l`).
* Live overall progress plus per-file progress bars (only larger files are shown to reduce churn).
* Immediate log flushing after each record for real-time visibility.
* Cancellation: cooperative; in‑flight work stops gracefully, partial outputs (hash log, copied list, etc.) are preserved.

### Requirements
[Flutter SDK](https://docs.flutter.dev/get-started/install) 3.9+ installed.

### Running the GUI
```
git clone https://github.com/thursby/ciphercopy.git
cd ciphercopy/app
flutter pub get
flutter run   # choose a desktop target
```

### Using the GUI
1. Select operation (Copy or Verify).
2. Specify options:
   * Copy: list file + destination directory.
   * Verify: `.sha1` manifest file.
   * (Optional) Enable "Save copied / errored file lists".
3. Start and watch progress. You can cancel at any time; completed files remain logged.
4. When finished, open or reveal the log from the status area, or reset to start a new run.

### GUI Outputs
Outputs mirror the CLI (see below) and are produced via the shared core. The log file is also copied alongside the destination (copy) or manifest (verify) for convenience.

### Cancellation Semantics
On cancellation the core stops spawning new worker isolates and signals existing ones. Already finished files remain in the SHA-1 manifest and copied list; incomplete files are excluded. This allows partial auditing or resumption logic in future enhancements.

---

## CLI

### Features

Same features as the GUI, but implemented as a CLI.

### Requirements
* Install the Flutter SDK from the GUI section as it includes the Dart SDK.
* Alternatively just install (Dart SDK 3.9+)[https://dart.dev/get-dart]


### Installation

Clone and get dependencies:

```sh
git clone https://github.com/thursby/ciphercopy.git
cd ciphercopy/cli
dart pub get
```

### Usage

Run with a list file and a destination directory:

```sh
dart run bin/ciphercopy_cli.dart [list_file] [destination_directory]
```

Flags:

* `-h, --help` Show usage
* `-t, --threads <count>` Number of concurrent threads (defaults to the number of CPU cores minus 1)
* `-l, --list` Also write `copied.txt` and `errored.txt` in the destination
* `--verify <hashes.sha1>` Verify instead of copy (omit list & destination args)

Examples:

```sh
# Basic
dart run bin/ciphercopy_cli.dart ~/Downloads/list.txt ~/Downloads/dest

# Limit concurrency
dart run bin/ciphercopy_cli.dart -t 4 ~/Downloads/list.txt ~/Downloads/dest

# Also emit copied.txt and errored.txt
dart run bin/ciphercopy_cli.dart -l ~/Downloads/list.txt ~/Downloads/dest

# Verify using defaults (threads = CPU cores)
dart run bin/ciphercopy_cli.dart --verify ~/Downloads/dest/hashes.sha1
```

### Verify files using a .sha1 manifest

Use `--verify` with the path to a `hashes.sha1` file produced by this app. The verification runs multi-threaded and shows the same per-file + overall progress bars.

```sh
# Limit concurrency during verify
dart run bin/ciphercopy_cli.dart --verify -t 4 ~/Downloads/dest/hashes.sha1
```

Output summary example:

```
Overall: ████████████████████████████  135/135 100.0%
Verify complete: 135/135 OK, 0 mismatched, 0 errors.
```

### List file format

* Plain text; one path per line
* Empty lines are ignored
* Directory entries are skipped
* Absolute or relative paths are accepted

Paths are preserved under the destination. If a path starts with `/`, the leading slash is removed to keep a relative layout under the destination.

Example `list.txt`:

```
/Users/alex/projects/a/big.iso
./assets/images/logo.png
relative/path/to/file.txt
```

### Library Usage (Core)

Both the CLI and GUI depend on the shared library in `core/`.

Add to your own `pubspec.yaml`:

```yaml
dependencies:
  ciphercopy_core: ^1.0.0   # (When published) – currently path-based inside this mono-repo
```

Import and use:

```dart
import 'package:ciphercopy_core/ciphercopy_core.dart';

// Copy
await copyFilesFromList(listPath, destinationDir,
    threadCount: 8,
    saveLists: true,
    cancelToken: token,
    onProgress: (e) { /* update UI */ });

// Verify
final summary = await verifyFromSha1('dest/hashes.sha1',
    threadCount: 8,
    cancelToken: token,
    onProgress: (e) { /* update UI */ });
```

Progress is streamed via `ProgressEvent` objects (file start, chunk progress, file done, overall counters). `CancellationToken` enables cooperative cancellation.

### Outputs

In the destination directory (copy mode):

* `hashes.sha1` Combined SHA-1 list in the format: `<sha1>  <absolute-dest-file-path>`
* `copied.txt` (with `-l`) All copied file paths
* `errored.txt` (with `-l`) Any files that failed to copy

Logging:

* A log file is created in the project working directory, e.g. `copy-<dest-name>-YYYY-MM-DD-HH-SS.log`
* In copy mode, the log is copied into the destination directory at the end
* In verify mode, the log is copied alongside the `.sha1` manifest

### Exit codes

* `0` Success
* `64` Usage error (missing/invalid arguments)
* `2` Runtime error (copy or hash failures encountered)

### How it works

* Main isolate reads the list, prepares destination paths, and spawns up to N worker isolates
* Each worker streams a source file to the destination, reports periodic progress, and computes the SHA-1 while copying
* The main isolate writes the combined `hashes.sha1`, maintains progress bars, and optionally writes copied/errored manifests
* In verify mode, workers compute SHA-1 for each file listed in the manifest and compare against the expected hash; progress is reported the same way

### Troubleshooting

* “Permission denied”: ensure read access to sources and write permissions to the destination
* “No such file or directory”: verify paths in your list file exist
* Slow copies: try reducing `--threads` if I/O is saturated, or increasing it on fast storage
* Progress garbled: use a terminal with ANSI support and sufficient width

### Features To Do
* Implement something like PGP + OpenTimestamps to verify manifest has not been modified
* Copy directories (not just file lists)
* Resume interrupted copies
* Configurable hash algorithms (e.g., SHA-256, MD5)
* Exclude/include patterns for file selection
